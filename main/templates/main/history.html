{% extends 'main/base.html' %}
{% block title %}Historique{% endblock %}

{% block content %}
<div class="page-header">
  <div class="ph-inner">
    <span class="s-label">Historique</span>
    <h1>Tous les dossiers</h1>
    <p>{{ documents.count }} dossier{% if documents.count > 1 %}s{% endif %} au total</p>
  </div>
</div>

<div class="container">
  {% if not documents %}
  <div class="card" style="padding:3rem;text-align:center">
    <div style="font-size:2rem;margin-bottom:1rem">ğŸ“</div>
    <h2 style="font-family:'Playfair Display',serif;font-size:1.3rem;margin-bottom:.8rem">Aucun dossier</h2>
    <a href="{% url 'import' %}" class="btn btn-gold">DÃ©poser un premier dossier</a>
  </div>
  {% else %}
  <div class="card fade-up">
    <table class="data-table">
      <thead>
        <tr>
          <th>Ref</th>
          <th>Projet</th>
          <th>Client</th>
          <th>Date</th>
          <th>Statut</th>
          <th>RT2012</th>
          <th>RE2020</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for doc in documents %}
        <tr>
          <td><span style="font-family:monospace;font-size:.78rem;color:var(--gold)">DOC-{{ doc.id|stringformat:"04d" }}</span></td>
          <td><strong style="color:var(--white)">{{ doc.name }}</strong></td>
          <td>{{ doc.client_name|default:"â€”" }}</td>
          <td>{{ doc.upload_date|date:"d/m/Y" }}</td>
          <td>
            {% if doc.status == 'recu' %}<span class="badge badge-gray">ReÃ§u</span>
            {% elif doc.status == 'en_cours' %}<span class="badge badge-warning">En cours</span>
            {% elif doc.status == 'termine' %}<span class="badge badge-success">TerminÃ©</span>{% endif %}
          </td>
          <td>
            {% if doc.rt2012_is_conform is None %}<span class="text-muted">â€”</span>
            {% elif doc.rt2012_is_conform %}<span class="badge badge-success">âœ“</span>
            {% else %}<span class="badge badge-danger">âœ—</span>{% endif %}
          </td>
          <td>
            {% if doc.re2020_is_conform is None %}<span class="text-muted">â€”</span>
            {% elif doc.re2020_is_conform %}<span class="badge badge-success">âœ“</span>
            {% else %}<span class="badge badge-danger">âœ—</span>{% endif %}
          </td>
          <td>
            <div style="display:flex;gap:.4rem;flex-wrap:wrap">
              <a href="{% url 'tracking' doc.tracking_token %}" class="btn btn-outline btn-sm">ğŸ”—</a>
              <a href="{% url 'download_report' doc.id %}" class="btn btn-outline btn-sm">ğŸ“„</a>
              <form method="post" action="{% url 'delete_document' doc.id %}" style="display:inline" onsubmit="return confirm('Supprimer ce dossier ?')">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm">ğŸ—‘</button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</div>
{% endblock %}
