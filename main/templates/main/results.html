{% extends 'main/base.html' %}
{% load conformity_tags %}
{% block title %}RÃ©sultats d'analyse{% endblock %}

{% block content %}
<div class="page-header">
  <div class="ph-inner">
    <span class="s-label">RÃ©sultats</span>
    <h1>Analyse de conformitÃ©</h1>
    <p>DÃ©tail des critÃ¨res RT2012 et RE2020 par dossier</p>
  </div>
</div>

<div class="container">

  {% if not documents %}
  <div class="card" style="padding:3rem;text-align:center" class="fade-up">
    <div style="font-size:2rem;margin-bottom:1rem">ðŸ“Š</div>
    <h2 style="font-family:'Playfair Display',serif;font-size:1.3rem;margin-bottom:.8rem">Aucun rÃ©sultat disponible</h2>
    <p style="color:var(--gray-2);font-weight:300;margin-bottom:1.5rem">DÃ©posez un document pour lancer une analyse.</p>
    <a href="{% url 'import' %}" class="btn btn-gold">DÃ©poser un dossier â†’</a>
  </div>
  {% else %}

  {% for doc in documents %}
  <div class="card" style="margin-bottom:2rem;overflow:hidden" class="fade-up">
    <!-- Doc header -->
    <div style="background:linear-gradient(135deg,var(--navy-3),var(--navy-2));padding:1.8rem 2rem;border-bottom:1px solid rgba(255,255,255,.05);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem">
      <div>
        <h2 style="font-family:'Playfair Display',serif;font-size:1.2rem;margin-bottom:.3rem">{{ doc.name }}</h2>
        <span style="font-size:.78rem;color:var(--gray-1)">DÃ©posÃ© le {{ doc.upload_date|date:"d/m/Y" }}{% if doc.client_name %} Â· {{ doc.client_name }}{% endif %}</span>
      </div>
      <div style="display:flex;gap:.8rem;align-items:center">
        {% if doc.rt2012_is_conform is not None %}
          {% if doc.rt2012_is_conform %}<span class="badge badge-success">âœ“ RT2012 Conforme</span>
          {% else %}<span class="badge badge-danger">âœ— RT2012 Non conforme</span>{% endif %}
        {% endif %}
        {% if doc.re2020_is_conform is not None %}
          {% if doc.re2020_is_conform %}<span class="badge badge-success">âœ“ RE2020 Conforme</span>
          {% else %}<span class="badge badge-danger">âœ— RE2020 Non conforme</span>{% endif %}
        {% endif %}
        <a href="{% url 'download_report' doc.id %}" class="btn btn-outline btn-sm">ðŸ“„ Rapport</a>
      </div>
    </div>

    <div style="padding:2rem;display:grid;grid-template-columns:1fr 1fr;gap:2rem">

      <!-- RT2012 -->
      <div>
        <h3 style="font-size:.78rem;letter-spacing:.1em;text-transform:uppercase;color:var(--gold);margin-bottom:1.2rem">RT2012 â€” CritÃ¨res</h3>
        <div style="display:flex;flex-direction:column;gap:.6rem">
          {% if doc.rt2012_bbio is not None %}
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.6rem .8rem;background:var(--navy-3);border-radius:6px">
            <span style="font-size:.85rem;color:var(--gray-2)">Bbio</span>
            <div style="display:flex;align-items:center;gap:.6rem">
              <span style="font-size:.85rem;color:var(--white);font-weight:500">{{ doc.rt2012_bbio }}</span>
              <span style="font-size:.72rem;color:var(--gray-1)">/ {{ rt2012_requirements.bbio }}</span>
              {% if doc.rt2012_bbio|is_conform_adapted:"rt2012_bbio" %}<span class="badge badge-success" style="font-size:.65rem">âœ“</span>
              {% else %}<span class="badge badge-danger" style="font-size:.65rem">âœ—</span>{% endif %}
            </div>
          </div>
          {% endif %}
          {% if doc.rt2012_cep is not None %}
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.6rem .8rem;background:var(--navy-3);border-radius:6px">
            <span style="font-size:.85rem;color:var(--gray-2)">Cep</span>
            <div style="display:flex;align-items:center;gap:.6rem">
              <span style="font-size:.85rem;color:var(--white);font-weight:500">{{ doc.rt2012_cep }}</span>
              <span style="font-size:.72rem;color:var(--gray-1)">/ {{ rt2012_requirements.cep }}</span>
              {% if doc.rt2012_cep|is_conform_adapted:"rt2012_cep" %}<span class="badge badge-success" style="font-size:.65rem">âœ“</span>
              {% else %}<span class="badge badge-danger" style="font-size:.65rem">âœ—</span>{% endif %}
            </div>
          </div>
          {% endif %}
          {% if doc.rt2012_tic is not None %}
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.6rem .8rem;background:var(--navy-3);border-radius:6px">
            <span style="font-size:.85rem;color:var(--gray-2)">Tic</span>
            <div style="display:flex;align-items:center;gap:.6rem">
              <span style="font-size:.85rem;color:var(--white);font-weight:500">{{ doc.rt2012_tic }}</span>
              <span style="font-size:.72rem;color:var(--gray-1)">/ {{ rt2012_requirements.tic }}Â°C</span>
              {% if doc.rt2012_tic|is_conform_adapted:"rt2012_tic" %}<span class="badge badge-success" style="font-size:.65rem">âœ“</span>
              {% else %}<span class="badge badge-danger" style="font-size:.65rem">âœ—</span>{% endif %}
            </div>
          </div>
          {% endif %}
          {% if doc.rt2012_airtightness is not None %}
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.6rem .8rem;background:var(--navy-3);border-radius:6px">
            <span style="font-size:.85rem;color:var(--gray-2)">Ã‰tanchÃ©itÃ©</span>
            <div style="display:flex;align-items:center;gap:.6rem">
              <span style="font-size:.85rem;color:var(--white);font-weight:500">{{ doc.rt2012_airtightness }}</span>
              <span style="font-size:.72rem;color:var(--gray-1)">â‰¤ {{ rt2012_requirements.airtightness }}</span>
              {% if doc.rt2012_airtightness|is_conform_adapted:"rt2012_airtightness" %}<span class="badge badge-success" style="font-size:.65rem">âœ“</span>
              {% else %}<span class="badge badge-danger" style="font-size:.65rem">âœ—</span>{% endif %}
            </div>
          </div>
          {% endif %}
          {% if not doc.rt2012_bbio and not doc.rt2012_cep %}
          <p style="font-size:.83rem;color:var(--muted);font-style:italic">DonnÃ©es RT2012 non extraites du document.</p>
          {% endif %}
        </div>
      </div>

      <!-- RE2020 -->
      <div>
        <h3 style="font-size:.78rem;letter-spacing:.1em;text-transform:uppercase;color:var(--gold);margin-bottom:1.2rem">RE2020 â€” CritÃ¨res</h3>
        <div style="display:flex;flex-direction:column;gap:.6rem">
          {% if doc.re2020_energy_efficiency is not None %}
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.6rem .8rem;background:var(--navy-3);border-radius:6px">
            <span style="font-size:.85rem;color:var(--gray-2)">Ã‰nergie (Cep)</span>
            <div style="display:flex;align-items:center;gap:.6rem">
              <span style="font-size:.85rem;color:var(--white);font-weight:500">{{ doc.re2020_energy_efficiency }}</span>
              <span style="font-size:.72rem;color:var(--gray-1)">/ {{ re2020_requirements.energy_efficiency }}</span>
              {% if doc.re2020_energy_efficiency|is_conform_adapted:"re2020_energy_efficiency" %}<span class="badge badge-success" style="font-size:.65rem">âœ“</span>
              {% else %}<span class="badge badge-danger" style="font-size:.65rem">âœ—</span>{% endif %}
            </div>
          </div>
          {% endif %}
          {% if doc.re2020_carbon_emissions is not None %}
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.6rem .8rem;background:var(--navy-3);border-radius:6px">
            <span style="font-size:.85rem;color:var(--gray-2)">Ic Ã©nergie (COâ‚‚)</span>
            <div style="display:flex;align-items:center;gap:.6rem">
              <span style="font-size:.85rem;color:var(--white);font-weight:500">{{ doc.re2020_carbon_emissions }}</span>
              <span style="font-size:.72rem;color:var(--gray-1)">/ {{ re2020_requirements.carbon_emissions }}</span>
              {% if doc.re2020_carbon_emissions|is_conform_adapted:"re2020_carbon_emissions" %}<span class="badge badge-success" style="font-size:.65rem">âœ“</span>
              {% else %}<span class="badge badge-danger" style="font-size:.65rem">âœ—</span>{% endif %}
            </div>
          </div>
          {% endif %}
          {% if doc.re2020_thermal_comfort is not None %}
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.6rem .8rem;background:var(--navy-3);border-radius:6px">
            <span style="font-size:.85rem;color:var(--gray-2)">Confort thermique (DH)</span>
            <div style="display:flex;align-items:center;gap:.6rem">
              <span style="font-size:.85rem;color:var(--white);font-weight:500">{{ doc.re2020_thermal_comfort }}</span>
              <span style="font-size:.72rem;color:var(--gray-1)">/ {{ re2020_requirements.thermal_comfort }}</span>
              {% if doc.re2020_thermal_comfort|is_conform_adapted:"re2020_thermal_comfort" %}<span class="badge badge-success" style="font-size:.65rem">âœ“</span>
              {% else %}<span class="badge badge-danger" style="font-size:.65rem">âœ—</span>{% endif %}
            </div>
          </div>
          {% endif %}
          {% if not doc.re2020_energy_efficiency and not doc.re2020_carbon_emissions %}
          <p style="font-size:.83rem;color:var(--muted);font-style:italic">DonnÃ©es RE2020 non extraites du document.</p>
          {% endif %}
        </div>
      </div>

    </div>
  </div>
  {% endfor %}
  {% endif %}
</div>
{% endblock %}
