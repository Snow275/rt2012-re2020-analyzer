{% extends 'main/base.html' %}
{% block title %}Résultats{% endblock %}
{% block content %}
{% load conformity_tags %}

<div class="container mt-4">
    <h2>Résultats de l'analyse RE2020</h2>
    <table class="table table-bordered">
        <thead class="thead-light">
            <tr>
                <th>Document</th>
                <th>Efficacité énergétique (RE2020)</th>
                <th>Confort thermique (RE2020)</th>
                <th>Émissions de carbone (RE2020)</th>
                <th>Gestion de l'eau (RE2020)</th>
                <th>Qualité de l'air intérieur (RE2020)</th>
                <th>Statut</th>
            </tr>
        </thead>
        <tbody>
            {% for document in documents %}
            <tr>
                <td><strong>{{ document.name }}</strong></td>

                <td style="color: {% if document.re2020_energy_efficiency|is_conform:re2020_requirements.energy_efficiency %}green{% else %}red{% endif %};">
                    {{ document.re2020_energy_efficiency|floatformat:1 }} / {{ re2020_requirements.energy_efficiency }}
                </td>

                <td style="color: {% if document.re2020_thermal_comfort|is_conform:re2020_requirements.thermal_comfort %}green{% else %}red{% endif %};">
                    {{ document.re2020_thermal_comfort|floatformat:1 }} / {{ re2020_requirements.thermal_comfort }}
                </td>

                <td style="color: {% if document.re2020_carbon_emissions|is_conform:re2020_requirements.carbon_emissions %}green{% else %}red{% endif %};">
                    {{ document.re2020_carbon_emissions|floatformat:1 }} / {{ re2020_requirements.carbon_emissions }}
                </td>

                <td style="color: {% if document.re2020_water_management|is_conform:re2020_requirements.water_management %}green{% else %}red{% endif %};">
                    {{ document.re2020_water_management|floatformat:1 }} / {{ re2020_requirements.water_management }}
                </td>

                <td style="color: {% if document.re2020_indoor_air_quality|is_conform:re2020_requirements.indoor_air_quality %}green{% else %}red{% endif %};">
                    {{ document.re2020_indoor_air_quality|floatformat:1 }} / {{ re2020_requirements.indoor_air_quality }}
                </td>

                <td style="font-weight: bold; color: {% if document.re2020_is_conform %}green{% else %}red{% endif %};">
                  {% if document.re2020_is_conform %}
                    Conforme
                  {% else %}
                    Non conforme
                  {% endif %}
                </td>
                    
            </tr>
            {% empty %}
            <tr><td colspan="7">Aucun document analysé.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <h2 class="mt-5">Résultats de l'analyse RT 2012</h2>
    <table class="table table-bordered">
        <thead class="thead-light">
            <tr>
                <th>Document</th>
                <th>Bbio (RT 2012)</th>
                <th>Cep (RT 2012)</th>
                <th>Tic (RT 2012)</th>
                <th>Étanchéité à l’air (RT 2012)</th>
                <th>ENR (RT 2012)</th>
                <th>Statut</th>
            </tr>
        </thead>
        <tbody>
            {% for document in documents %}
            <tr>
                <td><strong>{{ document.name }}</strong></td>

                <td style="color: {% if document.rt2012_bbio|is_conform:rt2012_requirements.bbio %}green{% else %}red{% endif %};">
                    {{ document.rt2012_bbio|floatformat:1 }} / {{ rt2012_requirements.bbio }}
                </td>

                <td style="color: {% if document.rt2012_cep|is_conform:rt2012_requirements.cep %}green{% else %}red{% endif %};">
                    {{ document.rt2012_cep|floatformat:1 }} / {{ rt2012_requirements.cep }}
                </td>

                <td style="color: {% if document.rt2012_tic|is_conform:rt2012_requirements.tic %}green{% else %}red{% endif %};">
                    {{ document.rt2012_tic|floatformat:1 }} / {{ rt2012_requirements.tic }}
                </td>

                <td style="color: {% if document.rt2012_airtightness|is_conform:rt2012_requirements.airtightness %}green{% else %}red{% endif %};">
                    {{ document.rt2012_airtightness|floatformat:2 }} / {{ rt2012_requirements.airtightness }}
                </td>

                <td style="color: {% if document.rt2012_enr|is_conform:rt2012_requirements.enr %}green{% else %}red{% endif %};">
                    {{ document.rt2012_enr|floatformat:1 }} / {{ rt2012_requirements.enr }}
                </td>

                <td style="font-weight: bold; color: {% if document.rt2012_is_conform %}green{% else %}red{% endif %};">
                    {% if document.rt2012_is_conform %}
                        Conforme
                    {% else %}
                        Non conforme
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2 class="mt-5">Actions</h2>
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Document</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for document in documents %}
            <tr>
                <td>{{ document.name }}</td>
                <td>
                    <a href="{% url 'download_report' document.id %}" class="btn btn-primary btn-sm">
                        Télécharger le Rapport
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
