{% extends 'main/base.html' %}
{% block title %}Tableau de bord{% endblock %}

{% block content %}
<div class="page-header">
  <div class="ph-inner">
    <span class="s-label">Tableau de bord</span>
    <h1>Vue d'ensemble des dossiers</h1>
    <p>Analyse indÃ©pendante RT2012 / RE2020 â€” dÃ©lai garanti 15 jours ouvrÃ©s</p>
  </div>
</div>

<div class="container">

  <!-- Stats -->
  <div class="stats-grid fade-up">
    <div class="stat-card">
      <div class="stat-label">Dossiers actifs</div>
      <div class="stat-value">{{ total_projects }}</div>
      <div class="stat-sub">projets en cours ou analysÃ©s</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Taux de conformitÃ©</div>
      <div class="stat-value">{{ compliance_rate }}<span style="font-size:1.2rem">%</span></div>
      <div class="stat-sub">dossiers conformes RT2012 ou RE2020</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Ã‰missions COâ‚‚ moyennes</div>
      <div class="stat-value">{{ avg_carbon }}<span style="font-size:1.2rem"> kg</span></div>
      <div class="stat-sub">moyenne RE2020 sur les dossiers analysÃ©s</div>
    </div>
  </div>

  <!-- CTA si pas de dossiers -->
  {% if total_projects == 0 %}
  <div class="card card-gold fade-up-2" style="padding:3rem;text-align:center">
    <div style="font-size:2.5rem;margin-bottom:1rem">ðŸ“‚</div>
    <h2 style="font-family:'Playfair Display',serif;font-size:1.5rem;margin-bottom:.8rem">Aucun dossier pour l'instant</h2>
    <p style="color:var(--gray-2);font-weight:300;margin-bottom:1.8rem;font-size:.95rem">DÃ©posez votre premier document pour lancer une analyse RT2012 / RE2020.</p>
    <a href="{% url 'import' %}" class="btn btn-gold">DÃ©poser un dossier â†’</a>
  </div>
  {% else %}

  <!-- Dossiers rÃ©cents -->
  <div class="fade-up-2">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.2rem">
      <h2 style="font-family:'Playfair Display',serif;font-size:1.3rem">Dossiers rÃ©cents</h2>
      <a href="{% url 'history' %}" class="btn btn-outline btn-sm">Voir tout l'historique</a>
    </div>

    <div class="card">
      <table class="data-table">
        <thead>
          <tr>
            <th>Projet</th>
            <th>Client</th>
            <th>Date</th>
            <th>Statut</th>
            <th>RT2012</th>
            <th>RE2020</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for doc in documents|slice:":8" %}
          <tr>
            <td><strong style="color:var(--white)">{{ doc.name }}</strong></td>
            <td>{{ doc.client_name|default:"â€”" }}</td>
            <td>{{ doc.upload_date|date:"d/m/Y" }}</td>
            <td>
              {% if doc.status == 'recu' %}<span class="badge badge-gray">ReÃ§u</span>
              {% elif doc.status == 'en_cours' %}<span class="badge badge-warning">En cours</span>
              {% elif doc.status == 'termine' %}<span class="badge badge-success">TerminÃ©</span>
              {% endif %}
            </td>
            <td>
              {% if doc.rt2012_is_conform is None %}<span class="text-muted">â€”</span>
              {% elif doc.rt2012_is_conform %}<span class="badge badge-success">âœ“ Conforme</span>
              {% else %}<span class="badge badge-danger">âœ— Non conforme</span>
              {% endif %}
            </td>
            <td>
              {% if doc.re2020_is_conform is None %}<span class="text-muted">â€”</span>
              {% elif doc.re2020_is_conform %}<span class="badge badge-success">âœ“ Conforme</span>
              {% else %}<span class="badge badge-danger">âœ— Non conforme</span>
              {% endif %}
            </td>
            <td>
              <div style="display:flex;gap:.5rem">
                <a href="{% url 'download_report' doc.id %}" class="btn btn-outline btn-sm">ðŸ“„ Rapport</a>
                <a href="{% url 'tracking' doc.tracking_token %}" class="btn btn-outline btn-sm">ðŸ”— Suivi</a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}

  <!-- Actions rapides -->
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem;margin-top:2.5rem" class="fade-up-3">
    <a href="{% url 'import' %}" class="card" style="padding:1.8rem;text-decoration:none;display:block;transition:all .3s;cursor:pointer" onmouseover="this.style.borderColor='rgba(200,168,75,.3)'" onmouseout="this.style.borderColor='rgba(255,255,255,.06)'">
      <div style="font-size:1.5rem;margin-bottom:.8rem">ðŸ“¤</div>
      <h3 style="font-family:'Playfair Display',serif;font-size:1.05rem;margin-bottom:.4rem;color:var(--white)">DÃ©poser un dossier</h3>
      <p style="font-size:.83rem;color:var(--gray-1);font-weight:300">Uploader un PDF pour analyse RT2012 / RE2020</p>
    </a>
    <a href="{% url 'results' %}" class="card" style="padding:1.8rem;text-decoration:none;display:block;transition:all .3s" onmouseover="this.style.borderColor='rgba(200,168,75,.3)'" onmouseout="this.style.borderColor='rgba(255,255,255,.06)'">
      <div style="font-size:1.5rem;margin-bottom:.8rem">ðŸ“Š</div>
      <h3 style="font-family:'Playfair Display',serif;font-size:1.05rem;margin-bottom:.4rem;color:var(--white)">Voir les rÃ©sultats</h3>
      <p style="font-size:.83rem;color:var(--gray-1);font-weight:300">DÃ©tail des conformitÃ©s par critÃ¨re</p>
    </a>
    <a href="{% url 'contact' %}" class="card" style="padding:1.8rem;text-decoration:none;display:block;transition:all .3s" onmouseover="this.style.borderColor='rgba(200,168,75,.3)'" onmouseout="this.style.borderColor='rgba(255,255,255,.06)'">
      <div style="font-size:1.5rem;margin-bottom:.8rem">ðŸ’¬</div>
      <h3 style="font-family:'Playfair Display',serif;font-size:1.05rem;margin-bottom:.4rem;color:var(--white)">Contacter l'expert</h3>
      <p style="font-size:.83rem;color:var(--gray-1);font-weight:300">Question sur un dossier ou devis</p>
    </a>
  </div>

</div>
{% endblock %}
